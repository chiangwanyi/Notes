# ICMP

Internet Control Message Protocol，互联网控制消息协议，用于网际协议（IP）中发送控制消息，提供可能发生在通信环境中的各种问题反馈。

## 报文结构

| **Bits** | **0-7** | **8-15** |     **16-31**      |
| :------: | :-----: | :------: | :----------------: |
|   内容   |  Type   |   Code   | 校验码（checksum） |

不同的类型（Type）和代码（Code）标识不同的内容。

## 报文类型

常见的报文类型有：

| **类型** | **编码** | **描述**                 |
| -------- | -------- | ------------------------ |
| 0        | 0        | Echo Reply（echo响应）   |
| 3        | 0        | 目标网络不可达           |
| 3        | 1        | 目标主机不可达           |
| 3        | 2        | 目标协议不可达           |
| 3        | 3        | 目标端口不可达           |
| 5        | 0        | 重定向网络               |
| 8        | 0        | Echo Request（echo请求） |

> 详细内容：[互联网控制消息协议：报文类型](https://zh.wikipedia.org/zh-cn/%E4%BA%92%E8%81%94%E7%BD%91%E6%8E%A7%E5%88%B6%E6%B6%88%E6%81%AF%E5%8D%8F%E8%AE%AE#%E6%8A%A5%E6%96%87%E7%B1%BB%E5%9E%8B)

## Ping

ICMP协议最常应用在Ping工具中，Ping工具使用ICMP报文检查与目标主机之间的连通性、连通质量等信息。以在Windows环境下使用Ping工具为例，有以下常见情况：

| **类型** | **回显**                                           | **原因**                                       | **备注**                     |
| -------- | -------------------------------------------------- | ---------------------------------------------- | ---------------------------- |
| 成功     | `来自 192.168.1.2 的回复：字节=32 时间=3ms TTL=64` | 目标主机可达                                   |                              |
| 超时     | `请求超时`                                         | 对方主机不在线，不存在，屏蔽（防火墙防Ping）等 | ICMP包发送成功，但得不到响应 |
| 传输失败 | `PING：传输失败。General failure`                  | Ping其他网络主机，但自身未配置网关             | ICMP包发送失败               |
| 无法访问 | `来自 192.168.1.1 的回复：无法访问`                | 网关没有路由功能，没有目标主机MAC地址          |                              |

